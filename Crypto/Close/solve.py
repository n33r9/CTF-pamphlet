import logging
import os
import sys
from itertools import product
from math import gcd
from Crypto.Util.number import *

from sage.all import ZZ

sys.path.append("../..")

from crypto_attacks.attacks.acd.ol import attack

Ns = [2130976337586005237156464206440420238795565461269490301585855909243137947798414127770622674742724352434331955896863644115665473805181972333821798148318799414303412313764438520452979811024935800578317205194535118744206321140383615692221976332951446168327815156707303807757477643618478178097808590013870602530571978483874107959618249495480404703039921462919059600508942634416478729156246889530274312285677320148095767520776395382610426929918977563944737154815051073804770658613252320954771991606103098402264525379694922957368418168481371020472830737481531266630093221880319725471683836854133653864083162346785113297683705360085961158753163727611496209455438221912781269299711779832658189935673806833012531569328477760118728288998405856941007991900725659274293982786073642879717420962731703476868833118161112664313792413800564596946051574011354351831603624300154840811613782989056951172522500835314687914163366650332659633288163, 2724037318674271086650447702070622375034861255304438717212172859171502986139415815041303457248662898812636029870181169539698582157596678976319885943602013615596314541242314223796153426926255235152668722870474200290619913816825637578268245306697316483895912232417073776730330891849576569682680319366880421269826884414700000757784798502289304103210140185862955753436603722506089178809949852990108336262759717632367946203946246293777315895381895311165687091955990889229787046729823535584170695122315779869883592318911535794642950406414658398131464828814786912910452684500515681764429615217619353314875027749599080323389716386057532469740854693102887806019415096201152871365561547406714917294252954637321114547657092913684836104437438009065254935303766017775862067651265645828848328151185935792297944544632491664122092606459921464368198588017057047648122587163017214781076851088421955611649541557810984363440551831480883100894756, 3383691878575471137089480888231172217866372258737361724957049521443443763029492809957409855991601293006223529553883773627262495918396580897315269393280090785607968778675228571143800897710500032700970973479956266461645024228597797295405062451269007563713263628196000287257749403776819070878113025521171955244378522212336359386213357451545050706081701069044868262458018932816656573810080433013346290226230600368695800792576148525630013674812581362450498826742727103970523587676787319516950204652226049894689926060531804700811668476231071908657043230214206125790484400070750115887590529367278059485685813618860125616508009373173700272979627354838587983949365228826137095388053111649098562302326183354472597204968565593722161991837351387615485549721520279021350590308413210999753314846116160847470647157455724360861290543130383536365633765271408624374535169271534024038682821784256903999466933064864745320489800372659636332745046, 3332851029830030020505312984858653864345835268092239580990493634816507465430956556762570304817073168605608529751959654545598713625624868535189519475633800845574486091187281279194464271600451330990793201223344729337160440769167384107356313334614380612681788939375289389552144092580754111812673799210293171571982790813487441850940616422874478885343212354265965733309928658793814208027091847421067475414218368539114727554252047972983373810874608325994896019236467640264187075166139858244443447044173305977034944223075961886821726913126402563633247855133971551147199604314569161069733929079286010685677153823781994220227408147047766849481286415120189298226090927049839969843135486078365496550479979529714310517104538163512763611247082326619524794973225502128429325265447729855527054260487797674749859721550631596291203249557847087262131821860919842254911909880721230913107733946362614921747812086494067811669012763198977877196090]
cts = [2920799356879250173447111776038849181098558087641816048276631516536993523688193882092723029394546779536095873224544585725343156520463117216509685723490837241788574056945457366746185782643192664508237067226182087617606922537076464379133415387617426663206748930129120915798950639705647090473111761353381273404261455424208890011694857621299074960837146049595989606332923828202391960344832094705857766885009460934356064579109718550008690634313743379177775192620804868609023704893202702912741883629599893521811884276941254734185373234781643402532721762824003010414264945053079309315313865134962984195976009130323486788964038228855989435947696966520440141881382228773099941354795667168696081093318535589931321297264982050645689991199266432933470181417203529616360597081020312451026614640803827775464538418865077879521754960625334043261141672384390722420825219108230411712055121935009223994581765203572536902273404299758455675439716, 283216691602083334005246638968097857275267182294137317946325320359123795402430057506720593818727474662215098329510647142743643046436685426552528303484369356060407286254097580835495484150137250253871785207943571863397430360490243515230128774584253289192899011248527340887737629761871089668382770396310606432582053901293299931822613593989274141244630173519376210793660273216088694636414125888456705896597034509313899057277107826790904466879762376556518540280095501421291226002138895857852530608767139681322733544708974607912631493011084548500839002454904505608611532002954434523431696045222506719263349729636693599700448447286366487016240653311773413719301479555195204721651263835365753283741191961306000271550958386765572111800785813811467614971291858380424207212470984391167760694805331930671076508836978834832661887925799776640390840470977875974323060557817792235965552255885276226057560230583826658034583575801554695059047, 268979405122804393027170445530338446206610074742832867718235870457475626024942680826027972068483238903246745764920875307179316418909178761558070465939341662641793197823095292334590592800021790441975896979146907263444313097546935175608594332475985436351896079585299623851919343338824266834209570792007094916396719215272148044469796689662013572640280148250625383108400184325618687803818355414450557575712792024247281478742164458095028155116210812552094668489765384790292604864975666989160165230770573449907091076407504614433265625180391580977483917983831858464922447770185414815446860865289281855742507304882746806308667258925044364467364740363097016993746642009182837176837819962230359591693139409031241687572877844627566755145072816229129417335557343315356662961165699996512043446852934695488341048967406782608764841478879940658782647794264034547319866199830285283932601838086989657960652975690033258066348895790073241794014, 1521158362715155454097756931052727717878889869688712453486606517629270329777684406452036981546430242564656146926258714199957602504207629834143865996729006122009889382535315498401491725307558088861688867142674873316236088299621053183453269904865862625765686025696069252520191342674399759900363487828527390473331876374877066463173271550524728008041915614246144806074264715708703233530474446610975016681526269110640669256441069042633622793941942259576439672237348714735168439068342911261074945918185355498255850927504972534036307621100571535263476170038941793883514864519982892473549754232231586079824086768168302432512297722672301238996302640516015249179302849667304288360560228729309230540380560519733720817984973175451050660458649685273186719284955088708283941197117266321098232994179275405962963082204615237311233943307292001768528015035597262519767340674366161929437638853140199198272216964710062026811799480052533506554371]

result = attack(Ns, 32 * 8)
p = result[0]
q = [Ns[i] // p for i in range(4)]
cts = cts[0]
for i in range(4):
    e = 65537
    phi = (p - 1)*(q[i] - 1)
    d = pow(e, -1, phi)
    print(long_to_bytes(pow(cts, d, p * q[i])))
    
"""
b'0\x80/zw\x8a\x8e\x17Rp\x15\xb6(,2scX2\xbf!#B\x88\xd1\x00\xc27\x10(\t\x1d\xef\xda\xc0;\x85\xcfh/\xdb\x83\xc1\x9a\x16\x13g2\xcd\xb5>\xb4\x0b!\xf2a\xb6\x10\x1c\xbb5\xa7\xe1Z\xb4\xc0\\\x82\xa9\x1b\xf8\xbdiU\x7f\x95E\xa7\xdb\x06H\xf3v\xa5\x8a\xffQ\xc7\xa8h`;=/\x8c\xa7\xcc\xf9\xd5\xe4\x91L\x0be:"\xa4\xac\x18\xf5\x8e\xe4(\xee\xc5\xc3mA\x8aAMu\xb3jq\x82\xe7\x9e\x11\xceG\xe9\x82\xc1\xcce\xf4a\x18%\x01y\x1d~\x87\x88\x00\xcc\xa9\xe71\x9aj\xc2\xd0\x10x7\x8f\xdd/n\xfa\x0b\xb6\x06\xe2[\xbcxW\xb0Q\xc1(\x01\x85\x05=r\x98\xf2\xc4\x8f\x1dh\xe3\xea 1\x93\x13\xfcP,\x8e\xc7\xec`\x98)\xeaj\xe4\xe8\x08\x8a2pzP($\xb7p\x07T0\x7fpb\xa6\xbe\xd1\x0e\xc2\xee\xcc\x18r\xc2\n\xbc\xc1u*\xc0A\xec_\x04\x93\x81\xa5\x7f\x88\xaf\xf735\x0e\xa1\xeb\xd9\xda*?v&\x19\n\xebQ\xed\x9d\xa60\x1f\xf6\x19\x1f\xb83N9?\xe6\xe0pA\xc9\xd8\x0f\x95\xa7K\x1c@\x88\xd5]\xd4\x93G\x8b\x7fk:^\x8dZ\xc1\x81\x89e\x9d\x1b\xd0\xce\xf0\x8e\xa0&`Maa\xe9\xc1U=}\xbaT\x8f\x19<\x8a\xb0)\r\x82\x15\xd6\x05F\xba\x8e\x91\xafV\xcd\xd16\xfd\x92\x0e\'\x88\x91\x89\x06\xe0\x00\xac\xbf\xb9\xee\xf2?U\x97\x86i>\x1a\xcds\xb0=\x18S\xd3\xfd\x8f\xa7jG\xc0y\x92+\xc2\xba'
b"\x14b\xa4:/@)\xba'E;*\xdc\xeaaD\xad\xb4\xf4\\\xdf\x93\xdb\x94.\xa3MQ\x17\x00\xa6P\xad[4\x02\xc3\xf8\x91\xfa\x0fAY\x1cT\xb09o\xde\x8b\x95\xce\xaa\x92\xf16i\xb6H\x86t\xfc'\xc5\xc7\xa1V\x91xg\xa9\xd5\x92I\xf3\xb9TK\xfd\x15\x99\x15i\xe3,\xffh?r\xcfe\x8c\xc4\xa0I\xba\x97\x96,\x1c{\xcb\xf4\x99\xac\xcb\xe0\xf7\xcb*\xec}\xbb\xea\xc2*W\xe2\xaa\xff\xe9q\xef\x17\x86Fn\x89.|\xd72^R\xe1\x8a\x15\xa8H\xa4A\xf8\x08\x8a\x80c4\x99\xe9\xf3\xda}\xf6\xd2\x9f\x83\x00\x8a\x00czNp\xaa:&\x02DOB\x1f\x92\xcc\xaf\xf2\xc0\x7f \xc3p\x13\xf9\x13\xf67l\x8e\xbf\x9f\xdd+\xcdY\x08\x83At \xdd$cJ.\x8c\xf5\xbe\x02\xe1\xf6\x07A\x8a\x82\xc4&KI\xbco\xb5\xf1\tk\xcf\x1a%N.7\xaaB1\xdad\xaa\xe0\xef3\xe9\x1b\xe8\x88I\x05\x17g\xaa\xfe\x90\xca\xf9s\xcb\x7f\xa9gkX\x81\x8a\xa6\xa9M\xcfr@\x06i_\x837\x9f.Yh\xa0\x13deH\x90$\xa6;P*\xf12c\xfb\xa7\xc2s\xb2_\x84jS\x00\xb7\x1e\xd0\xbcp\xfe*\xff\r\x11\xc3)\xbd5\xe0\xf05\xf7\xe0i\xf8\x84\x07\xf9\x0b\xe0Y\xd70\xc6E[f\xeet\\=\x0e\xbdM\xb4H\x03B\xcf\xe8\x07\xc7T@c\x81%'\xb7H;\xce\x7f\xc0\xa3\xcc_\xd8\x9c{\xd9_\xe8\xbf\xbb\x94\xc5&j\x06\xc9f\xff\xe3:f\xb0\xb8&"
b'ASCIS{jUsT_l4tt1C3_tR1cK5_4nD_ACD_pR0bL3M!!}\xf6R\xca\xa1\xe4og\xc0-\x12~8\xda\xea\rj<\x99\x84`~Y;\x88\xa4\xfe\xae\xeb9n\xe3\xb6\x95Z\x9bS\xc5\xf8\x92\xb6\xe4n\xc0S\xf6\x92H\x17\xd6\xad.\t\xf2!\xfe\xed\xc0\xf0\x13\x84\x89"A\r\xcf\xdb\xd2\t\xbd\'YBS+\x0bNF\xach\xe4i\x0e\xb5\xa4\xe6VV\x95\x05:\xe8\xc5&!\xab\xd0S\xd2\xf6\xc1\rU\xbb;\xca\xe5j\x84Kx\x1e\xee\xd0\xa5I\xef\xc5\x02\xaf\xe9\xa7\xf7\x11\xcf\xa3\x06\x82/\xf3\xa7|\xce4L1\r\xd3\x00\n\x04.\r\x132c\xfc\x14AI\xce!\xec\x8c\x943\x9b\xcf\xeb\x81\xdc\x9d\x0e,^\xf2qa\x85j\x98\x1a\xd3\xce\x93\x1cA\xc5\xc0.\xf7\'E\x91\x08c;\x80\xae\xf9N\x9cG\xf6d\x0f\x05\x92m\x82\xd1\x9a\xcb\xc4A\xd2\xd5q\xeb\xca\xfd\x13\xc2Aj\xd7\xa3\t\xbc*\xd7\xbf\x83\xb0QW\xe3\x8e\x89+\x8a\xb7x\xf7n\xcc\xe0E\x06_\x88\xd6"\x9cn\xf5\xaa\x01\xd7\x12\x98 \x97p09\x8a\xb3\xfa\x95.\xe5\xc1\x13cS\xe7\xd5\xd6\xd7\x8dE_#&\n\xd3\x11\xbbQ\x82_\xca\xda\'@\xbfA)\x07\x91\x88\xae\xbd\x1b\x80\xff\xaa\x8c0\xbb\x12$\xdb\x8e0\'^\xcam\xafyw\x12\x0b\xcc1\x8c\xb7&\xe7\x01\xfb\xb1\xb1 \xf5\x93l_\xab\xee\x974\x10O\xa6*:'
b'u\xa7-\x93y+\x99\xd9\xe2\x88[\x05\x96\x0b\xbd\xfa\x84\xa7W<\x7f\xacx\xdd\x08\xaaq\xb5B\x81M\x8b\xfd\xf3\xb0C\xe0\xed\xad!)\xb2\xf0\xb1_v\xb5\t\n_J\xba\xe8rP.\x1a\xc0\xca\xad\xffb\xbbo\x9b)\xdc\x8c\x1b\xe3\xb7\xe2>h\xb4\x1b\x7f\xf7\xbc\xca\xddd\xe0\xb3@\x1e\xbeI\xc4\xc7\x8c#\xb5kj\xafS\xe4\xc3\xf3\x91\xe0\xa9 @<\xba!\xe3\x9fL\xb9\xe6\xc4\x00$\xd05\xd0$6\x0f[\x82_G@\x02\x9e\x10\xb2\x9b\x08+i\xe1\xf2\xce\xa2*3B\xa5h\xadn\x8c\x7f\xeb\xe2\xe8\xda\r\xbf2\x17\xa9\xc3\xd8\xca\xf9\xa8\xe6{4\x00/:0z\x87/\xa8\x1fP\x9aT1\x81\x95\xf8U\x81\xbc\x10\xfb\xf5K{\x05\x1d\x8e}j\xed\xc2\x00Z\xe0\x91\xef\xda\xe5\x0f\xe2\xd5MeL`\xf16\xb5\x14\xbbY\xfd\xb7ud\xa7\x0b\xc1\xd2S\xc5\xe6\xbeY\xdd\xb0\xc7\xaft\xf8\x9f\xb2u\n3\x811\x1d\x9b\x084L\xff\x81\x08!P\xb4\xe7i\xca\x8c\xb4\xe06\xc8y\xc7\xef/}}`\x9e\x95\x85\x1aV\xa6<\x08P\xc3>G4W\x8b\xd9\xb4\xea\x18::T\xf4\x08L\xb2\x1c\x84\xf7r\xb3\xde \xdb!2~\xf5f\xe5V\x83\xa8)n\xdb\xc4\xc6\x15\xb8\xce\xf4\x93|\x1c\xb2\xa1\xb0\x0e\xbf\xde\xc0\x86\xc0\xde\xbd\x0f5\xaf\xae\x8c\x89E\x80w\xcf\xb8vi1y\xfa]\x14\x16\n4\xc7\xc1c~q\xae>\x98U1\x11\xc9T\x82\x08\x0c.\xc36Ex\xd2*$\xd6\xbbz\xa2\xc0'
"""